var MAIN_FLOW_DIR="3d-cost-calculator",TYPE_PAGE="/".concat(MAIN_FLOW_DIR,"/type-select"),UPLOAD_PAGE="/".concat(MAIN_FLOW_DIR,"/upload"),LOADING_PAGE="/".concat(MAIN_FLOW_DIR,"/estimating"),ESTIMATION_ERROR="/".concat(MAIN_FLOW_DIR,"/estimation-error"),SUMMARY_PAGE="/".concat(MAIN_FLOW_DIR,"/quote-summary"),firebaseConfig={apiKey:"AIzaSyAUDaF-EF93INxT30jiwFVwXqM3-ps6JEY",authDomain:"cgtrader-arsenal.firebaseapp.com",projectId:"cgtrader-arsenal",storageBucket:"cgtrader-arsenal.appspot.com",messagingSenderId:"1076496760109",appId:"1:1076496760109:web:fcb5a623bb437ffc8e67a4"};function initTypeSelectPage(){var e=localStorage.getItem("type");e&&($(".type-radio").removeClass("type-radio--active"),$("#".concat(e)).parent(".type-radio").addClass("type-radio--active"),setTimeout(function(){$("#".concat(e)).parent(".type-radio").click()},100)),$("input[type=radio][name=type]").change(function(){save("type",e=this.value),$(".type-radio").removeClass("type-radio--active"),$("#".concat(e)).parent(".type-radio").addClass("type-radio--active")})}function initUploadPage(){localStorage.getItem("type")||(window.location.href=TYPE_PAGE);var o=!1,a=(localStorage.getItem("image")&&d(null),!1),i=($("#url").on("paste",function(e){e=e.originalEvent;e.clipboardData&&(a=!0,setTimeout(function(){a=!1},1e3),n(),r((e.clipboardData||window.clipboardData).getData("text")))}),"");function r(e){if(o=!!0,n(),!isValidUrl(e))return t();isImageUrl(e)?(save("image",e),d(null)):t()}function n(){$("#urlInvalid").hide(),$("#url").removeClass("error")}function t(){$("#urlInvalid").show(),$("#url").addClass("error")}$("#url").on("keyup",function(e){var t;a||((t=$("#url").val())||$(".upload-file-input__btn").hide(),t&&13==e.which?r(t):t&&t!==i?(i=t,$(".upload-file-input__btn").show(),n()):i="")}),$(".upload-file-input__btn").on("click",function(){r($("#url").val())}),$("#email-form").submit(function(e){return e.preventDefault(),!1});var l,c=document.getElementById("file"),m=(firebase.initializeApp(firebaseConfig),firebase.storage().ref());function s(){changeImage(),$("#uploadFileArea .upload").addClass("upload--error"),$("#uploadFileArea #fileInvalid").show()}function d(e){var t,a;o||((t=localStorage.getItem("image"))||(localStorage.removeItem("base64"),changeImage()),a=localStorage.getItem("base64"),$(".upload-form").hide(),$(".upload-result").show(),a?$(".upload-result__img").attr("src",a):e?$(".upload-result__img").attr("src",URL.createObjectURL(e)):$(".upload-result__img").attr("src",t),document.querySelector(".upload-result__img").addEventListener("load",function(){$(".upload-result__img").css("min-height","auto")}))}c.addEventListener("change",function(){$("#uploadFileArea .upload").removeClass("upload--error"),$("#uploadFileArea #fileInvalid").hide();var e=c.files[0];if("image/jpeg"!==e.type&&"image/webp"!==e.type&&"image/png"!==e.type)return s();if(5120<e.size/1024)return s();resizeImageToSpecificWidth(500,l=e,function(e){save("base64",e)});var t=e.name,a=($("#uploadFileProgress .h100").text(t),$("#uploadFileProgress .text100").text(Math.round(e.size/1024/1024*100)/100+" MB"),(new Date).getTime()),o=m.child("images/".concat(a,"-").concat(t)).put(e);o.on("state_changed",function(e){e=e.bytesTransferred/e.totalBytes*100;$("#uploadFileProgress .progress__bar").css("width","".concat(e,"%")),$("#uploadFileArea").hide(),$("#uploadFileProgress").css("display","flex")},function(e){},function(){o.snapshot.ref.getDownloadURL().then(function(e){save("image",e),d(l)})}),$("#cancelUpload").on("click",function(){o.cancel(),changeImage()})}),$(".upload-result__btn").on("click",function(){localStorage.removeItem("image"),localStorage.removeItem("base64"),c.value=null,url.value=null,$(".upload-result").hide(),$("#uploadFileArea").show(),$("#uploadFileProgress").hide(),$("#uploadFileProgress .progress__bar").css("width","0%"),$("#uploadFileProgress .text100").text("0 KB"),$(".upload-form").show()})}function initLoadingPage(){localStorage.getItem("type")||(window.location.href=TYPE_PAGE),localStorage.getItem("image")||(localStorage.removeItem("base64"),window.location.href=UPLOAD_PAGE);var t=localStorage.getItem("image"),e=localStorage.getItem("base64"),a=($(".estimate__img").attr("src",e||t),["exterior","interior","studio"]);setTimeout(function(){$.ajax({type:"POST",url:"https://us-central1-cgtrader-arsenal.cloudfunctions.net/getType",contentType:"application/json",data:JSON.stringify({method_id:"image_domain_v1.0",payload_items:[{name:"image_url",type:"string",data:t}]})}).done(function(e){e&&e.data&&e.data[0]&&a.includes(e.data[0])?$.ajax({type:"POST",url:"https://us-central1-cgtrader-arsenal.cloudfunctions.net/getType",contentType:"application/json",data:JSON.stringify({method_id:"complexity_v1.8",payload_items:[{name:"image_url",type:"string",data:t}]})}).done(function(e){e.name&&"complexity"===e.name&&e.data?(save("complexity",e.data),window.location.href=SUMMARY_PAGE):window.location.href=ESTIMATION_ERROR}).fail(function(e){console.log("error complexity_v1 ",e),window.location.href=ESTIMATION_ERROR}):window.location.href=ESTIMATION_ERROR}).fail(function(e){console.log("error image_domain_v1 ",e),window.location.href=ESTIMATION_ERROR})},2e3)}function initEstimationErrorPage(){var e=localStorage.getItem("image"),t=localStorage.getItem("base64");$(".estimate__img").attr("src",t||e),$(".upload-result__btn").on("click",function(e){e.preventDefault(),localStorage.removeItem("image"),localStorage.removeItem("base64"),window.location.href=UPLOAD_PAGE})}function initSummaryPage(){localStorage.getItem("type")||(window.location.href=TYPE_PAGE),localStorage.getItem("type")||localStorage.setItem("type","interactive"),localStorage.getItem("image")&&localStorage.getItem("complexity")||(localStorage.removeItem("base64"),window.location.href=UPLOAD_PAGE);var e=localStorage.getItem("complexity"),t=localStorage.getItem("type"),a=($(".q-sum").hide(),$(".q-sum#".concat(t)).css("display","flex"),localStorage.getItem("image")),o=localStorage.getItem("base64"),o=($(".q-sum__img").attr("src",o||a),$("#interactive .q-sum-price__number, #price-interactive").text("$".concat(getPrice("interactive",e))),$("#viewer .q-sum-price__number, #price-viewer").text("$".concat(getPrice("viewer",e))),$("#".concat(t," .h300")).text());$("input#source").val("service: ".concat(o," | image: ").concat(a," | Complexity: ").concat(e," | Price: ").concat(getPrice(t,e)))}function save(e,t){localStorage.setItem(e,t)}function clean(){localStorage.removeItem("image"),localStorage.removeItem("type"),localStorage.removeItem("complexity"),localStorage.removeItem("base64"),localStorage.removeItem("email")}function resizeImageToSpecificWidth(o,e,i){var r,t;e&&((t=new FileReader).onload=function(e){var a=new Image;a.onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=a.width,e.height=a.height,t.drawImage(a,0,0),a.width>a.height?(e.height=a.height/a.width*o,e.width=o):(e.width=a.width/a.height*o,e.height=o),t.drawImage(e,0,0,e.width,e.height),t.drawImage(a,0,0,e.width,e.height),r=e.toDataURL(),i(r)},a.src=e.target.result},t.readAsDataURL(e))}function isEmail(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}function isBusinessEmail(e){return/^([\w-\.]+@(?!gmail.com)(?!yahoo.com)(?!hotmail.com)(?!aol.com)(?!hotmail.co.uk)(?!hotmail.fr)(?!msn.com)(?!yahoo.fr)(?!wanadoo.fr)(?!orange.fr)(?!comcast.net)(?!yahoo.co.uk)(?!yahoo.com.br)(?!yahoo.co.in)(?!live.com)(?!rediffmail.com)(?!free.fr)(?!gmx.de)(?!web.de)(?!yandex.ru)(?!ymail.com)(?!libero.it)(?!outlook.com)(?!uol.com.br)(?!bol.com.br)(?!mail.ru)(?!cox.net)(?!hotmail.it)(?!sbcglobal.net)(?!sfr.fr)(?!live.fr)(?!verizon.net)(?!live.co.uk)(?!googlemail.com)(?!yahoo.es)(?!ig.com.br)(?!live.nl)(?!bigpond.com)(?!terra.com.br)(?!yahoo.it)(?!neuf.fr)(?!yahoo.de)(?!alice.it)(?!rocketmail.com)(?!att.net)(?!laposte.net)(?!facebook.com)(?!bellsouth.net)(?!yahoo.in)(?!hotmail.es)(?!charter.net)(?!yahoo.ca)(?!yahoo.com.au)(?!rambler.ru)(?!hotmail.de)(?!tiscali.it)(?!shaw.ca)(?!yahoo.co.jp)(?!sky.com)(?!earthlink.net)(?!optonline.net)(?!freenet.de)(?!t-online.de)(?!aliceadsl.fr)(?!virgilio.it)(?!home.nl)(?!qq.com)(?!telenet.be)(?!me.com)(?!yahoo.com.ar)(?!tiscali.co.uk)(?!yahoo.com.mx)(?!voila.fr)(?!gmx.net)(?!mail.com)(?!planet.nl)(?!tin.it)(?!live.it)(?!ntlworld.com)(?!arcor.de)(?!yahoo.co.id)(?!frontiernet.net)(?!hetnet.nl)(?!live.com.au)(?!yahoo.com.sg)(?!zonnet.nl)(?!club-internet.fr)(?!juno.com)(?!optusnet.com.au)(?!blueyonder.co.uk)(?!bluewin.ch)(?!skynet.be)(?!sympatico.ca)(?!windstream.net)(?!mac.com)(?!centurytel.net)(?!chello.nl)(?!live.ca)(?!aim.com)(?!bigpond.net.au)([\w-]+\.)+[\w-]{2,4})?$/.test(e)}function getPrice(e,t){var a=50;try{t=Math.round(t),a={interactive:[16,42,67,102,126,186,287,371,504,700],viewer:[16,42,67,102,126,186,287,371,504,700]}[e][t-1]}catch(e){}return a}function isValidUrl(e){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)}function isImageUrl(e){return/(http(s?):\/\/)([^\s(["<,>/]*)(\/)[^\s[",><]*(.png|.jpg|.jpeg|.webp)(\?[^\s[",><]*)?/i.test(e)}document.addEventListener("DOMContentLoaded",function(e){switch(window.location.pathname){case TYPE_PAGE:initTypeSelectPage();break;case UPLOAD_PAGE:initUploadPage();break;case LOADING_PAGE:initLoadingPage();break;case ESTIMATION_ERROR:initEstimationErrorPage();break;case SUMMARY_PAGE:initSummaryPage()}});